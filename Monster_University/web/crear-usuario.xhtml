<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                template="/template.xhtml">

    <ui:define name="title">Crear Nuevo Usuario</ui:define>

    <ui:define name="body">
        <div class="form-container" style="max-width: 800px; margin: 0 auto; padding: 20px; background-color: rgba(255, 255, 255, 0.95); border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: relative; z-index: 1;">
            
            <script>
                function debug(message) {
                    console.log("[DEBUG] " + message);
                }
                
                function debugError(message) {
                    console.error("[ERROR] " + message);
                }
                
                function debugSuccess(message) {
                    console.log("‚úÖ " + message);
                }
                
                console.log("=== FORMULARIO CREAR USUARIO CARGADO ===");
                
                document.addEventListener('DOMContentLoaded', function() {
                    console.log("üìù INSTRUCCIONES:");
                    console.log("1. Llena el formulario");
                    console.log("2. Haz click en 'Crear Usuario'");
                    console.log("3. Revisa los mensajes aqu√≠ debajo");
                    console.log("4. Si hay errores, se mostrar√°n en rojo");
                });
            </script>
            
            <style>
                .form-header {
                    text-align: center;
                    margin-bottom: 30px;
                    border-bottom: 2px solid #2a64c5;
                    padding-bottom: 10px;
                }
                
                .form-header h1 {
                    color: #2a64c5;
                    font-size: 2rem;
                    margin-bottom: 5px;
                }
                
                .form-header p {
                    color: #666;
                    font-size: 1rem;
                }
                
                .form-group {
                    margin-bottom: 20px;
                    padding: 10px;
                    border-radius: 5px;
                    background-color: #f8f9fa;
                }
                
                .form-label {
                    display: block;
                    margin-bottom: 8px;
                    font-weight: bold;
                    color: #495057;
                    font-size: 0.9rem;
                }
                
                .form-required {
                    color: #dc3545;
                    margin-left: 3px;
                }
                
                .form-actions {
                    margin-top: 30px;
                    text-align: center;
                    padding-top: 20px;
                    border-top: 1px solid #dee2e6;
                }
                
                .form-help {
                    margin-top: 15px;
                    padding: 10px;
                    background-color: #e7f3ff;
                    border-left: 4px solid #2a64c5;
                    font-size: 0.9rem;
                    color: #666;
                }
            </style>
            
            <div class="form-header">
                <h1>üë§ Crear Nuevo Usuario</h1>
                <p>Complete todos los campos requeridos para registrar un nuevo usuario en el sistema</p>
            </div>
            
            <h:form id="formCrearUsuario">
                <p:panel header="Datos del Usuario" styleClass="form-panel" style="border: none; background: transparent;">
                    
                    <!-- ID Usuario -->
                    <div class="form-group">
                        <h:outputLabel for="xeusuId" value="ID Usuario" styleClass="form-label"/>
                        <span class="form-required">*</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <p:inputText id="xeusuId" value="#{crearUsuarioController.nuevoUsuario.xeusuId}" 
                                       maxlength="5" style="width: 120px;"
                                       placeholder="Ej: USR01"
                                       onchange="debug('ID Usuario cambiado: ' + this.value)"
                                       required="true"
                                       requiredMessage="El ID de usuario es requerido"/>
                            <p:outputLabel value="(M√°ximo 5 caracteres)" style="font-size: 0.8rem; color: #666;"/>
                        </div>
                        <p:message for="xeusuId" display="icon"/>
                    </div>

                    <!-- Nombre -->
                    <div class="form-group">
                        <h:outputLabel for="xeusuNombre" value="Nombre Completo" styleClass="form-label"/>
                        <span class="form-required">*</span>
                        <p:inputText id="xeusuNombre" value="#{crearUsuarioController.nuevoUsuario.xeusuNombre}" 
                                   maxlength="100" style="width: 100%;"
                                   placeholder="Ingrese el nombre completo del usuario"
                                   onchange="debug('Nombre cambiado: ' + this.value)"
                                   required="true"
                                   requiredMessage="El nombre completo es requerido"/>
                        <p:message for="xeusuNombre" display="icon"/>
                    </div>

                    <!-- Contrase√±a -->
                    <div class="form-group">
                        <h:outputLabel for="xeusuContra" value="Contrase√±a" styleClass="form-label"/>
                        <span class="form-required">*</span>
                        <p:password id="xeusuContra" value="#{crearUsuarioController.nuevoUsuario.xeusuContra}" 
                                  feedback="true" promptLabel="Ingresa contrase√±a" 
                                  weakLabel="D√©bil" goodLabel="Buena" strongLabel="Fuerte"
                                  style="width: 250px;"
                                  onchange="debug('Contrase√±a cambiada (longitud): ' + this.value.length)"
                                  required="true"
                                  requiredMessage="La contrase√±a es requerida"/>
                        <p:message for="xeusuContra" display="icon"/>
                    </div>

                    <!-- Confirmar Contrase√±a -->
                    <div class="form-group">
                        <h:outputLabel for="confirmarContrasena" value="Confirmar Contrase√±a" styleClass="form-label"/>
                        <span class="form-required">*</span>
                        <p:password id="confirmarContrasena" value="#{crearUsuarioController.confirmarContrasena}" 
                                  style="width: 250px;"
                                  onchange="debug('Confirmar contrase√±a cambiada (longitud): ' + this.value.length)"
                                  required="true"
                                  requiredMessage="Debe confirmar la contrase√±a"/>
                        <p:message for="confirmarContrasena" display="icon"/>
                    </div>

                    <!-- Estado -->
                    <div class="form-group">
                        <h:outputLabel for="xeusuEstado" value="Estado" styleClass="form-label"/>
                        <span class="form-required">*</span>
                        <p:selectOneMenu id="xeusuEstado" value="#{crearUsuarioController.nuevoUsuario.xeusuEstado}" 
                                       style="width: 200px;"
                                       onchange="debug('Estado seleccionado: ' + this.value)"
                                       required="true"
                                       requiredMessage="Debe seleccionar un estado">
                            <f:selectItem itemLabel="Seleccione estado" itemValue=""/>
                            <f:selectItem itemLabel="ACTIVO" itemValue="ACTIVO"/>
                            <f:selectItem itemLabel="INACTIVO" itemValue="INACTIVO"/>
                        </p:selectOneMenu>
                        <p:message for="xeusuEstado" display="icon"/>
                    </div>

                    <!-- Ayuda -->
                    <div class="form-help">
                        <p><strong>üìã Nota:</strong> Todos los campos marcados con <span class="form-required">*</span> son obligatorios.</p>
                        <p>‚Ä¢ El ID de usuario debe ser √∫nico en el sistema.</p>
                        <p>‚Ä¢ La contrase√±a debe tener al menos 8 caracteres para ser segura.</p>
                        <p>‚Ä¢ Los usuarios INACTIVOS no podr√°n iniciar sesi√≥n en el sistema.</p>
                    </div>

                    <!-- Botones de acci√≥n -->
                    <div class="form-actions">
                        <p:commandButton value="üíæ Crear Usuario" 
                                       action="#{crearUsuarioController.crearUsuario}"
                                       update="@form :growl"
                                       icon="pi pi-save"
                                       styleClass="ui-button-primary"
                                       style="margin-right: 10px; padding: 8px 20px;"
                                       onstart="debug('=== INICIANDO CREACI√ìN DE USUARIO ==='); 
                                                debug('Haciendo click en Crear Usuario...');"/>
                        
                        <p:commandButton value="üîÑ Limpiar" 
                                       action="#{crearUsuarioController.initNuevoUsuario}"
                                       update="@form :growl"
                                       immediate="true"
                                       icon="pi pi-refresh"
                                       styleClass="ui-button-secondary"
                                       style="padding: 8px 20px;"
                                       onstart="debug('Limpiando formulario...')"/>
                        
                        <p:button value="‚Ü©Ô∏è Cancelar" 
                                icon="pi pi-times"
                                outcome="/index1.xhtml"
                                style="margin-left: 10px; padding: 8px 20px;"/>
                    </div>
                </p:panel>
            </h:form>
        </div>
    </ui:define>

    <ui:define name="footer">
        <div style="width: 100%; text-align: center; font-size: 0.9rem; color: #666;">
            ¬© #{java.time.LocalDate.now().year} Monster University - Sistema de Gesti√≥n Acad√©mica
        </div>
    </ui:define>
</ui:composition>